var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function o(t){try{h(i.next(t))}catch(e){a(e)}}function s(t){try{h(i["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(o,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,a=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){h.label=r[1];break}if(6===r[0]&&h.label<o[1]){h.label=o[1],o=r;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(r);break}o[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},GameScene=function(t){function e(){var e=t.call(this)||this;e.createRoad(20,6),e.road=[];var r=new RoadItem;r.scaleX=r.scaleY=2,e.addChild(r),r.x=500,r.refresh(TYPE.ODD,LINE.NON),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.road.push(1),e.setRoad(e.road)},e);var i=new RoadItem;return i.scaleX=i.scaleY=2,e.addChild(i),i.x=500,i.y=60,i.refresh(TYPE.EVEN,LINE.NON),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.road.push(2),e.setRoad(e.road)},e),e}return __extends(e,t),e.prototype.createRoad=function(t,e){this.numCol=t,this.numRow=e,this.dataMap=[],this.itemMap=[],this.drawLineList=[];for(var r=0;t>r;++r){this.dataMap[r]=[],this.itemMap[r]=[],this.drawLineList.push(0);for(var i=0;e>i;++i){this.dataMap[r][i]={head:-1,type:TYPE.NON};var n=new RoadItem;n.x=r*n.width,n.y=i*n.height,this.addChild(n),this.itemMap[r][i]=n}}this.head=new Grid,this.cur=new Grid,this.dir=new Grid},e.prototype.reset=function(){for(var t=0;t<this.numCol;++t){this.drawLineList[t]=0;for(var e=0;e<this.numRow;++e)this.dataMap[t][e].head=-1,this.dataMap[t][e].type=TYPE.NON}this.head.reset(),this.cur.reset(),this.dir.reset(),this.beginCol=0},e.prototype.setRoad=function(t){this.reset();for(var e=-1,r=(LINE.NON,t.length),i=0;r>i;++i){egret.error(JSON.stringify(this.cur));var n=t[i],a=this.getTypeByResult(n);-1==e?(this.beginCol=0,this.head.col=this.beginCol,this.cur.col=this.beginCol,this.cur.row=this.head.row,this.dir.col=0,this.dir.row=0):e!=a?(this.beginCol++,this.head.col=this.beginCol,this.cur.col=this.beginCol,this.cur.row=this.head.row,this.dir.col=0,this.dir.row=0):(this.cur.row+this.dir.row>=this.numRow||this.dataMap[this.cur.col+this.dir.col][this.cur.row+this.dir.row]&&this.dataMap[this.cur.col+this.dir.col][this.cur.row+this.dir.row].type!=TYPE.NON)&&(this.dir.col=1,this.dir.row=0,0==this.cur.row||(this.drawLineList[this.head.col]=1)),0==this.cur.row&&this.dir.col>0&&this.beginCol++,this.cur.col+=this.dir.col,this.cur.row+=this.dir.row,e=a,this.dataMap[this.cur.col][this.cur.row].head=this.head.col,this.dataMap[this.cur.col][this.cur.row].type=a,0==this.dir.col&&0==this.dir.row&&(this.dir.row=1)}for(var o=0;o<this.numCol;++o)for(var s=0;s<this.numRow;++s){var h=this.dataMap[o][s],c=this.drawLineList[h.head]>0,d=LINE.NON;h.type!=TYPE.NON&&c&&(d=0==s?LINE.DOWN:this.dataMap[o+1][s]&&h.head==this.dataMap[o+1][s].head?this.dataMap[o][s-1]&&h.head==this.dataMap[o][s-1].head?LINE.UP|LINE.RIGHT:LINE.LEFT|LINE.RIGHT:this.dataMap[o-1]&&this.dataMap[o-1][s]&&h.head==this.dataMap[o-1][s].head?LINE.LEFT|LINE.RIGHT:LINE.UP|LINE.DOWN),this.itemMap[o][s].refresh(h.type,d)}},e.prototype.getTypeByResult=function(t){var e=TYPE.NON;return t&&(e=t%2==0?TYPE.EVEN:TYPE.ODD),e},e}(egret.Sprite);__reflect(GameScene.prototype,"GameScene");var Grid=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.col=0,this.row=0,this.col=t,this.row=e}return t.prototype.reset=function(){this.col=0,this.row=0},t}();__reflect(Grid.prototype,"Grid");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return this.addChild(new GameScene),[2];case 1:return r.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=r.sent(),this.startAnimation(t),[4,platform.login()];case 3:return r.sent(),[4,platform.getUserInfo()];case 4:return e=r.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return r.sent(),this.stage.removeChild(t),[3,4];case 3:return e=r.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,r=this.stage.stageHeight;t.width=e,t.height=r;var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,e,172),i.graphics.endFill(),i.y=33,this.addChild(i);var n=this.createBitmapByName("egret_icon_png");this.addChild(n),n.x=26,n.y=33;var a=new egret.Shape;a.graphics.lineStyle(2,16777215),a.graphics.moveTo(0,0),a.graphics.lineTo(0,117),a.graphics.endFill(),a.x=172,a.y=61,this.addChild(a);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.startAnimation=function(t){var e=this,r=new egret.HtmlTextParser,i=t.map(function(t){return r.parse(t)}),n=this.textfield,a=-1,o=function(){a++,a>=i.length&&(a=0);var t=i[a];n.textFlow=t;var r=egret.Tween.get(n);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(o,e)};o()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var TYPE;!function(t){t[t.NON=0]="NON",t[t.ODD=1]="ODD",t[t.EVEN=2]="EVEN"}(TYPE||(TYPE={}));var LINE=function(){function t(){}return t.NON=0,t.UP=1,t.DOWN=2,t.LEFT=4,t.RIGHT=8,t}();__reflect(LINE.prototype,"LINE");var RoadItem=function(t){function e(){var e=t.call(this)||this,r=new egret.Shape;return r.graphics.beginFill(10066329),r.graphics.drawRect(0,0,24,24),r.graphics.beginFill(0),r.graphics.drawRect(1,1,22,22),r.graphics.endFill(),e.addChild(r),e.tf=new egret.TextField,e.tf.fontFamily="微軟正黑體",e.tf.size=20,e.tf.x=e.tf.y=2,e.tf.text="單",e.addChild(e.tf),e.refresh(TYPE.NON,LINE.NON),e}return __extends(e,t),e.prototype.refresh=function(t,r){var i=this,n=0;switch(t){case TYPE.NON:this.tf.text="";break;case TYPE.ODD:this.tf.text="單",this.tf.textColor=16711680,n=16777215;break;case TYPE.EVEN:this.tf.text="雙",this.tf.textColor=52479,n=16777215}t!=TYPE.NON&&e.LINE_DEFINE.forEach(function(t){if(r&t.flag){var e=new egret.Shape;e.graphics.lineStyle(2,n,1),e.graphics.moveTo(12,12),e.graphics.lineTo(t.endX,t.endY),e.graphics.endFill(),i.addChild(e)}})},e.LINE_DEFINE=[{flag:LINE.UP,endX:12,endY:0},{flag:LINE.DOWN,endX:12,endY:24},{flag:LINE.LEFT,endX:0,endY:12},{flag:LINE.RIGHT,endX:24,endY:12}],e}(egret.Sprite);__reflect(RoadItem.prototype,"RoadItem");