var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,i){return new(a||(a=Promise))(function(r,n){function o(t){try{h(i.next(t))}catch(e){n(e)}}function s(t){try{h(i["throw"](t))}catch(e){n(e)}}function h(t){t.done?r(t.value):new a(function(e){e(t.value)}).then(o,s)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return i([t,e])}}function i(a){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,n&&(o=n[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return h.label++,{value:a[1],done:!1};case 5:h.label++,n=a[1],a=[0];continue;case 7:a=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){h=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){h.label=a[1];break}if(6===a[0]&&h.label<o[1]){h.label=o[1],o=a;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(a);break}o[2]&&h.ops.pop(),h.trys.pop();continue}a=e.call(t,h)}catch(i){a=[6,i],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var r,n,o,s,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},RoadData=function(){function t(){this.head=-1,this.type=t.NON,this.line=0}return Object.defineProperty(t.prototype,"isFull",{get:function(){return this.type!=t.NON},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.head=-1,this.type=t.NON},t.NON=0,t.ODD=1,t.EVEN=2,t.LINE_NON=0,t.LINE_UP=1,t.LINE_DOWN=2,t.LINE_LEFT=4,t.LINE_RIGHT=8,t}();__reflect(RoadData.prototype,"RoadData");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,a){function i(i){e.call(a,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameScene=function(t){function e(){var e=t.call(this)||this;return e.numCol=-1,e.numRow=-1,e.once(eui.UIEvent.COMPLETE,e.uiComplete,e),e.skinName="GameSceneSkin",e}return __extends(e,t),e.prototype.uiComplete=function(){var t=this;this.playBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onPlay,this),this.oddBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){-1!=t.numCol&&(t.results.push(1),t.drawBigRoad(t.results))},this),this.evenBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){-1!=t.numCol&&(t.results.push(2),t.drawBigRoad(t.results))},this)},e.prototype.onPlay=function(){var t=parseInt(this.columnTf.text),e=parseInt(this.rowTf.text);t&&e?(this.createRoad(t,e),this.results=[]):window.alert("輸入錯誤!")},e.prototype.createRoad=function(t,e){this.numCol=t-1,this.numRow=e,this.dataMap=[],this.itemMap=[],this.drawLineList=[];var a=0;for(a=0;a<this.numCol;++a){this.dataMap[a]=[],this.itemMap[a]=[],this.drawLineList.push(!1);for(var i=0;e>i;++i){this.dataMap[a][i]=new RoadData;var r=new RoadItem;r.x=a*r.width,r.y=i*r.height,this.container.addChild(r),this.itemMap[a][i]=r}}for(var i=0;e>i;++i){var r=new RoadItem;r.x=a*r.width,r.y=i*r.height,this.container.addChild(r)}this.pre=new Grid,this.dir=new Grid,this.target=new Grid},e.prototype.resetData=function(){for(var t=0;t<this.numCol;++t){this.drawLineList[t]=!1;for(var e=0;e<this.numRow;++e)this.dataMap[t][e].reset()}this.pre.reset(),this.dir.reset(),this.target.reset()},e.prototype.checkColumn=function(t){if(!this.dataMap[t]){this.dataMap[t]=[];for(var e=0;e<this.numRow;++e)this.dataMap[t][e]=new RoadData;this.drawLineList.push(!1)}},e.prototype.drawBigRoad=function(t){this.resetData();for(var e=(RoadData.LINE_NON,t.length),a=0,i=0;e>i;++i){var r=this.getTypeByResult(t[i]);if(0==i)this.target.setup(0,0,0),this.dir.toBottom();else if(r!=this.dataMap[this.pre.col][this.pre.row].type){var n=this.pre.head+(0==this.pre.row?a:0)+1;n<this.pre.col-this.numCol+1&&(n=this.pre.col-this.numCol+1),this.target.setup(n,n,0),this.checkColumn(this.target.col),a=0,this.dir.toBottom()}else this.target.setup(this.pre.head,this.pre.col+this.dir.col,this.pre.row+this.dir.row),this.checkColumn(this.target.col),(this.target.row>=this.numRow||this.dataMap[this.target.col][this.target.row].isFull)&&(this.dir.toRight(),this.target.setup(this.pre.head,this.pre.col+this.dir.col,this.pre.row+this.dir.row),this.checkColumn(this.target.col),0!=this.target.row&&(this.drawLineList[this.target.head]=!0));this.dir.col>0&&a++;var o=this.dataMap[this.target.col][this.target.row];o.head=this.target.head,o.type=r,this.pre.copy(this.target)}this.dataMap.reverse(),this.dataMap.length=this.numCol,this.dataMap.reverse();for(var s=0;s<this.numCol;++s)for(var h=0;h<this.numRow;++h){var l=this.dataMap[s][h],d=this.drawLineList[l.head],c=RoadData.LINE_NON;l.isFull&&d&&(c=0==h?RoadData.LINE_DOWN:this.dataMap[s+1]&&this.dataMap[s+1][h]&&l.head==this.dataMap[s+1][h].head?this.dataMap[s][h-1]&&l.head==this.dataMap[s][h-1].head?RoadData.LINE_UP|RoadData.LINE_RIGHT:RoadData.LINE_LEFT|RoadData.LINE_RIGHT:this.dataMap[s-1]&&this.dataMap[s-1][h]&&l.head==this.dataMap[s-1][h].head?RoadData.LINE_LEFT|RoadData.LINE_RIGHT:this.dataMap[s][h-1]&&l.head==this.dataMap[s][h-1].head?RoadData.LINE_UP|RoadData.LINE_DOWN:RoadData.LINE_LEFT|RoadData.LINE_RIGHT),this.itemMap[s][h].refresh(l.type,c)}},e.prototype.getTypeByResult=function(t){var e=RoadData.NON;return t&&(e=t%2==0?RoadData.EVEN:RoadData.ODD),e},e}(eui.Component);__reflect(GameScene.prototype,"GameScene");var Grid=function(){function t(t,e,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===a&&(a=0),this.head=0,this.col=0,this.row=0,this.col=t,this.row=e,this.head=a}return t.prototype.reset=function(){this.col=0,this.row=0,this.head=0},t.prototype.toRight=function(){this.col=1,this.row=0},t.prototype.toBottom=function(){this.col=0,this.row=1},t.prototype.setup=function(t,e,a){this.head=t,this.col=e,this.row=a},t.prototype.copy=function(t){this.head=t.head,this.col=t.col,this.row=t.row},t}();__reflect(Grid.prototype,"Grid");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return[4,this.loadResource()];case 1:return a.sent(),this.addChild(new GameScene),[2];case 2:return t=a.sent(),this.startAnimation(t),[4,platform.login()];case 3:return a.sent(),[4,platform.getUserInfo()];case 4:return e=a.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return a.sent(),[4,this.loadTheme()];case 2:return a.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return a.sent(),this.stage.removeChild(t),[3,5];case 4:return e=a.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,a){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,a=this.stage.stageHeight;t.width=e,t.height=a;var i=new egret.Shape;i.graphics.beginFill(0,.5),i.graphics.drawRect(0,0,e,172),i.graphics.endFill(),i.y=33,this.addChild(i);var r=this.createBitmapByName("egret_icon_png");this.addChild(r),r.x=26,r.y=33;var n=new egret.Shape;n.graphics.lineStyle(2,16777215),n.graphics.moveTo(0,0),n.graphics.lineTo(0,117),n.graphics.endFill(),n.x=172,n.y=61,this.addChild(n);var o=new egret.TextField;o.textColor=16777215,o.width=e-172,o.textAlign="center",o.text="Hello Egret",o.size=24,o.x=172,o.y=80,this.addChild(o);var s=new egret.TextField;this.addChild(s),s.alpha=0,s.width=e-172,s.textAlign=egret.HorizontalAlign.CENTER,s.size=24,s.textColor=16777215,s.x=172,s.y=135,this.textfield=s;var h=new eui.Button;h.label="Click!",h.horizontalCenter=0,h.verticalCenter=0,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,a=RES.getRes(t);return e.texture=a,e},e.prototype.startAnimation=function(t){var e=this,a=new egret.HtmlTextParser,i=t.map(function(t){return a.parse(t)}),r=this.textfield,n=-1,o=function(){n++,n>=i.length&&(n=0);var t=i[n];r.textFlow=t;var a=egret.Tween.get(r);a.to({alpha:1},200),a.wait(2e3),a.to({alpha:0},200),a.call(o,e)};o()},e.prototype.onButtonClick=function(t){var e=new eui.Panel;e.title="Title",e.horizontalCenter=0,e.verticalCenter=0,this.addChild(e)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var RoadItem=function(t){function e(){var e=t.call(this)||this,a=new egret.Shape;return a.graphics.beginFill(10066329),a.graphics.drawRect(0,0,24,24),a.graphics.beginFill(0),a.graphics.drawRect(1,1,22,22),a.graphics.endFill(),e.addChild(a),e.tf=new egret.TextField,e.tf.fontFamily="微軟正黑體",e.tf.size=20,e.tf.x=e.tf.y=2,e.tf.text="單",e.addChild(e.tf),e.lineContainer=new egret.DisplayObjectContainer,e.addChild(e.lineContainer),e.refresh(RoadData.NON,RoadData.LINE_NON),e}return __extends(e,t),e.prototype.refresh=function(t,a){var i=this,r=0;switch(t){case RoadData.NON:this.tf.text="";break;case RoadData.ODD:this.tf.text="單",this.tf.textColor=16711680,r=16777215;break;case RoadData.EVEN:this.tf.text="雙",this.tf.textColor=52479,r=16777215}this.lineContainer.removeChildren(),e.LINE_DEFINE.forEach(function(t){if(a&t.flag){var e=new egret.Shape;e.graphics.lineStyle(2,r,1),e.graphics.moveTo(12,12),e.graphics.lineTo(t.endX,t.endY),e.graphics.endFill(),i.lineContainer.addChild(e)}})},e.LINE_DEFINE=[{flag:RoadData.LINE_UP,endX:12,endY:0},{flag:RoadData.LINE_DOWN,endX:12,endY:24},{flag:RoadData.LINE_LEFT,endX:0,endY:12},{flag:RoadData.LINE_RIGHT,endX:24,endY:12}],e}(egret.Sprite);__reflect(RoadItem.prototype,"RoadItem");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,a,i){function r(t){e.call(i,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),a.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,a){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(a){window.JSONParseClass.setData(a),egret.callLater(function(){e.call(i,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);